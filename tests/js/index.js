const os = require("os");
const prebuildsFolder = `${os.platform()}-${os.arch()}`;
const JSRandomnessPredictor = require(`../../prebuilds/${prebuildsFolder}/js-randomness-predictor-cpp.node`);

const FIREFOX_SEQUENCE = [0.1321263101773572, 0.03366887439746058, 0.032596957696410134, 0.9986575482138969, 0.8479779907956815];
const FIREFOX_EXPECTED = [
  0.13963871472821332, 0.25068024611907636, 0.6656237481612675, 0.7381091878692425, 0.8709382509549467, 0.49171337524788294, 0.6991749430716799,
  0.9530887478758369, 0.781511163650037, 0.699311162730038,
];

const CHROME_SEQUENCE = [0.32096095967729477, 0.3940071672626849, 0.3363374923027722, 0.7518761096243554, 0.44201420586496387];
const CHROME_EXPECTED = [
  0.8199006769436774, 0.6250240806313154, 0.9101975676132608, 0.5889203398264599, 0.5571161440436232, 0.9619184649129092, 0.8385620929536599,
  0.3822042053588621, 0.5040552869863579, 0.12014019399083042, 0.44332968383610927, 0.37830079319230936, 0.542449069899975, 0.0659240460476268,
  0.9589494984837686, 0.007621633090565627, 0.14119301022498787, 0.9964718645470699, 0.14527130036353442, 0.6260597083849548, 0.86354903522581,
  0.7245123107811886, 0.6565323828155891, 0.3636039851663503, 0.5799453712253447,
];

const v8 = JSRandomnessPredictor.v8();
const V8_PREDICTIONS = Array.from({ length: 10 }, () => v8.predictNext());

const chrome = JSRandomnessPredictor.chrome(CHROME_SEQUENCE);
const CHROME_PREDICTIONS = Array.from({ length: CHROME_EXPECTED.length }, () => chrome.predictNext());

const firefox = JSRandomnessPredictor.firefox(FIREFOX_SEQUENCE);
const FIREFOX_PREDICTIONS = Array.from({ length: FIREFOX_EXPECTED.length }, () => firefox.predictNext());

if (!V8_PREDICTIONS.every((v, i) => v === Math.random())) {
  throw new Error(`V8 FAILED!`);
} else {
  console.log("V8 SUCCESS!");
}
if (!CHROME_EXPECTED.every((v, i) => v === CHROME_PREDICTIONS[i])) {
  throw new Error(`CHROME FAILED!`);
} else {
  console.log("CHROME SUCCESS!");
}
if (!FIREFOX_EXPECTED.every((v, i) => v === FIREFOX_PREDICTIONS[i])) {
  throw new Error(`FIREFOX FAILED!`);
} else {
  console.log("FIREFOX SUCCESS!");
}
